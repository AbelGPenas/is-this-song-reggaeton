import scrapy, json
from ..items import MamasitaItem
from scrapy.loader import ItemLoader
from difflib import SequenceMatcher
from ..custom_functions import remove_duplicate_songs

class letrascom_scraper(scrapy.Spider):
    name = "letrascom"

    def start_requests(self):
        with open('C:/Users/agpen/PycharmProjects/Mamasita/mamasita/mamasita/artists.json') as f:
            data = json.load(f)
        for genre in data.keys():
            for artist in data[genre]:
                artist_URL = 'https://www.letras.com/'+artist+'/'
                yield scrapy.Request(artist_URL, self.parse, priority=2)


    def parse(self, response):
        song_urls = response.xpath('.//li[@class="cnt-list-row -song is-visible"]/@data-shareurl').getall() #Get all the songs for the artist
        song_titles = response.xpath('.//li[@class="cnt-list-row -song is-visible"]/@data-name').getall()
        #Clean remixes and duplicates
        clean_urls = remove_duplicate_songs(song_urls, song_titles)
        for url in clean_urls:
            yield response.follow(url, callback=self.scrape_song, meta={
                'dont_retry': False,
                'dont_merge_cookies': True
                ,'priority': 0
                          })
    def scrape_song(self, response):
        loader = ItemLoader(item=MamasitaItem(), response=response)
        loader.add_xpath('title', '///div[@class="cnt-head_title"]/h1/text()')
        loader.add_xpath('lyrics', '///div[@class="cnt-letra p402_premium"]/p/text()')
        loader.add_xpath('artist', '///div[@class="cnt-head_title"]/h2/a/span/text()')

        yield loader.load_item()


songs = ['A Donde Ira Tu Corazon', 'A Mi Manera', 'A Pasarla Bonito Con Saqdt', 'Acelera', 'Acorralala', 'Adeus', 'Adiós', 'Adrenalina', 'Afuego', 'Agárrala', 'Aguas Calientes', 'Ahora Son Mejor Que Yo', 'Amarga Vida', 'Amiga Mía', 'Amigo', 'Amor De Colegio', 'Anda Sola', 'Angeles Y Demonios (feat. Syko El Terror Y Kendo Kaponi)', 'Angeles Y Demonios (feat. Syko Y Kendo Kaponi)', 'Angelito Vuela', 'Angelito Vuelva', 'Angelitos', 'Anque Te Fuiste [remix]', 'Asco Y Vergüenza', 'Asi Hasta Abajo Soy Yo  Remix (feat Daddy Yankee)', 'Asi Soy', 'Asi Soy Yo', 'AunEstoy Vivo', 'Aunque Te Fuiste', 'Ayer La Vi', 'Baila Morena', 'Bailando Bajo El Sol', 'Bailando Sola', 'Bandida Universitaria', 'Bandoleros (part. Tego Calderón)', 'Beautiful', 'BellyDanza', 'Blue Zone', 'Bomba', 'C02', 'Cae la noche', 'Calentando Conmigo', 'Callejero (feat Tego Calderon)', 'Calm My Nerves', 'Cancion de Amor', 'Candela', "Cara a Cara (Tiraera Pa' Daddy Yankee)", 'Carta a un Amigo', 'Carta Al Cielo', 'Caserio #2', 'Chau amor', 'Cheaters', 'Chequea Como se menea', 'Chica especial', 'Chillin (Feat. Tego Calderon)', 'Chuculun', 'CiaoBella', 'Circuito', 'Comenzo El Bayu', 'Como Olvidar', 'Conteo', 'Contigo', 'Coolant (Remix)', 'Corre Peligro', 'Corre Peligro (og Black)', 'Cuentale', 'Cuentame', 'Cuerpo sensual', 'Culpable', 'Dale Caliente', 'Dale Don Dale', 'Dale Don Dale RmX (Ft. Fabolous)', 'Dale Don Mas Duro', 'Dale Play', 'Dale vaquero', 'Dame De Eso', 'Dan den', 'Danza Kuduro (part. Lucenzo)', 'Danza Kuduro (remix Feat Lucenzo, Daddy Yankee & Arcangel)', 'Danza Kuduro (remix) (feat. Akon)', 'De Hombre A Hombre (feat Syko El Terror)', 'De Niña A Mujer', 'De Niña Te Hice Mi Mujer', 'Dejala En Dj Goldy - El Desorden', 'Demostrare Quien Soy', 'Dentro De Mi', 'Desafio', 'Desde Que Llegó', 'Desde Que Llegó - 2003 Remix', 'Destino cruel', 'Diana fácil', 'Dile','Diosa', 'Diva Virtual', 'Dobla Rodilla (feat Wisin)', 'Dogma Crew', 'Don Omar Barre a Daddy Yankee', 'Donkeo', 'Donqueo', 'Dra X', 'Dra. X', 'Dutty Love (part. Natti Natasha)', 'Easy', 'Easy (zion)', 'El Brindis', 'El cantante', 'El Curandero', 'El Desorden', 'El Doctorado (part. Tony Dize Y Ken Y)', 'El Duro', 'El Duro (feat. Kendo Kaponi)', 'El Duro Remix (feat. Kendo Kaponi, Daddy Yankee Y Baby Rasta)', 'El orfanato', 'El Pantalon', 'El Parque', 'El Rey', 'El Señor de La Noche', 'El Tamborilero', 'El traficante de plantas', 'Ella Anda Sola', 'Ella Ella', 'Ella Ella (Ft. Zion & Lennox)', 'Ella Se Contradice (feat. Baby Rasta Y Gringo, Plan B, Syko El Terror Y Kendo Kaponi)', 'Ella Y Yo (English Version)', 'Ella y Yo (part. Aventura)', 'Ellos Quieren', 'En el callejon', 'En La Hoguera', 'En lo Oscuro (ft  Wisin y Yandel)', 'En Su Nota', 'Enamorado de Ti (feat. Yandel)', 'Encanto', 'Enfermo de amor', 'Entre TuY Yo', 'Eso Perro', 'Esta Noche', 'Estoy Enamorado (feat Danny Fornaris)', 'Estoy Enamorado (ft Danny Fornaris)', 'Eta Cancion Fue Echa Por Dj Choyboy', 'Feeling Hot', 'Fiera', 'Fire (feat. Mr. Phillips & Jory Boy)', 'Flow callejero', 'Flow natural', 'Freestyle', 'Fui yo', 'Gabriel', 'Galactic Blues', 'Gata Fiera', 'Gata Gangster', 'Gata Suelta', 'Good Looking', 'Guatauba xXx', 'Guaya Guaya', 'Guayando', 'Guayaquil', 'Hasta Abajo', 'Hasta Abajo Remix (feat. Daddy Yankee)', 'Hasta Que Salga El Sol', 'Hold You Down feat. Jennifer Lopez', 'Hold Yuh (feat. Gyptian)', 'Hombre Aburrido', 'Hookah', 'How We Roll', 'Hoy nos vamos calle', 'Huerfano De Amor (feat Syko El Terror)', 'Huerfano de Amor (ft. Syko)', 'I Wait For You Love', 'I Wanna Love You', 'IL Capo', 'Incognita (Ft. Kendo Kaponi)', 'Incognitas (feat. Kendo Kaponi)', 'Infieles', 'Intocable', 'Intro', 'Intro Predica', 'Isla Bonita', 'Jangueo', 'Just like sexo', 'La Batidora', 'La Batidora 2 (part. Yaga y Mackie)', 'La Batidora En Vivo (Feat Glory)', 'La Bella Crisis', 'La copa', 'La gitana', 'La invasion', 'La llaman salvaje', 'La miré', 'LaMujer De Mis Suenos', 'La Mujeres de Tu Vida', 'La Niña', 'La Noche Esta Buena', 'La Pared', 'La Popola', 'La química de hoy', 'La Recompensa', 'La Tracionera ( Tradução )', 'La Traicionera', 'La vecinita tiene antojo', 'Lamento de Una Gargola', 'Las Mujeres de Tu Vida', 'Leona', 'Libertad', 'Lo hice por ti', 'Loba', 'Los hombres tienen la culpa', 'Los Matadores Del Genero', 'Love Is Pain', 'Luna', 'Luna Llena', 'Mala Es', 'Mayor Que Yo', 'Mayor que Yo 3 (part. Luny Tunes, Daddy Yankee, Wisin e Yandel)', 'Mayor Que Yo 3 (Parte 2) (part. Wisin y Yandel, Prince Royce y Nicky Jam)', 'Me arrepiento', 'Me Muero (feat. Marcy Place)', 'Me no Speak Americano', 'Medley de Exitos', 'Mi Esposa Y Yo', 'Mi Nena', 'Miralos', 'Mirame', 'Mirame Mirame', 'Miss Independiente', 'Money Makers', 'Morena', 'Moriria Por Ti', 'Mr. Romantic', 'Muevete Y Perrea', 'Muñeca de Porcelana', 'Muñecas De Porcelana', 'My Space', 'Nada Cambiará (feat. Xavi)', 'Nadie Como Tu', "Navidad Pa' La Calle", 'No Me Quitaron El Sueño', 'No Pares', 'No Se de Ella My Space', 'No Seta Lo Mismo', 'No Sigue Modas (feat. Juan Magan)', 'No Te Vayas (part. Alexis y Fido)', 'Noche De Adrenalina', 'Nosotros Dos', 'Not Too Much (part. Zion)', 'Oasis', 'Ojitos Chiquititos', 'Ojitos Chiquitos', 'Ok', 'Orphanization', 'Orphanization (feat. Syko El Terror Y Kendo Kaponi)', 'Orphanization (ft. Kendo KaponI Y Syko)', 'Orphanization(Feat.Syko y Kendo Kaponi)', 'Otra Noche', 'Pam Pam', 'Pasto Y Pelea', 'Patea', 'Perdido En Tus Ojos (part. Natti Natasha)', 'Perreando', 'Pide Mas', 'Pobre Diabla', 'Predica', 'Prince Of Egypt', 'Prince of Kings [Tiradera a Daddy Yankee]', 'Prosigo', 'Provocandome', 'Prueba de Sonido (feat Kendo Kaponi)', 'Psychos (feat Kendo Kaponi)', 'Pura Vida', 'Que Es La Que Hay (feat Syko El Terror Y Kendo Kaponi)', 'Que Es La Que Hay (ft. Kendo KaponI Y Syko)','Quien La Vio Llorar', 'Quien La Vio Llorar Fui Yo', 'Quimica', 'Quimica Sustancia (feat Arcangel)', 'quimica2', 'Quitate Hijo Mio', 'Ramayama (part. Farruko)', 'Ran Tan Tan', 'Reggaeton Latino', 'Reggaeton Latino Remix', 'reportence', 'Reportense', 'Robarte Un Beso (feat Ivi Queen )', 'Ronca', 'Rumba', 'Rx', 'Rx (ft. Kendo Kaponi)', 'Sácala (feat. Wisin & Yandel - Don Omar - Hector)', 'Salio El Sol', 'Salvaje', 'Sandunga Audio (feat. Tego Calderon)', 'Scandalous', 'Sci-fi', 'SciFi', 'Se Fue El Amor', 'Se vuelve loca', 'Sexy Robotica', 'Si Decides Irte', 'Si La Ves', "Si La Ves Feat. Rakim Y Ken-y '", 'Si La Vez', 'Si La Vez (Feat. Rakim Y Ken-y)', 'Slow Motion', 'Soledad', 'Somos Bandoleros', 'Soy Un Mendigo', 'Sr. Destino', 'Sr. Destino (ft Kendo Kaponi)', 'Stereo Love (Remix)', 'Suave Al Odio', 'Suave Al Oido', 'Subete', 'Suelta Como Gabete', 'Suelta Mami', 'Sueltate Conmigo', 'Taboo', 'Te Estas Calentando','Te Gusta El Regaeton', 'Te Gusta El Reggaeton', 'Te Ire a Buscar (feat Farruko Y Baby Rasta)', 'Te Quiero Pa´Mi', 'Te Quita o Nos Matamos', 'Te Quitas O Nos Matamos', 'Te Recordaré Balando', 'The Chosen', 'The Chosen & Virtual Diva (idon)', 'Tigi Tigi', 'Tiradera Aynkee 2ª Parte', 'Tiraera a Yankee', 'Tiraera a Yomo', 'Tiraera Pa Wisin', 'Tirate Al Medio (Feat Dadd Yankee)', 'Todo Lo Que Soy (Feat Marcy Place)', 'Track 4 (The Last Don)', 'Tu Cintura', 'Tu Cuerpo Me Arrebata', 'Tu No Sabes', 'Tu Te Estas Calentando', 'Tú Y Ella', 'Tus Movimientos(feat. Natty Natasha & Pitbull)', 'Un Cabrero Desayunando En La Ciudad', 'Vacilón', "Vamo'a Matarlos", 'Ven Sueltate', 'Veo', 'Vestido Blanco', 'Vida Loca', 'Virtual Diva', 'Viviendo Con El Enemigo (Ft. Kendo Kaponi)', 'Vivos Y Activos', 'Vuelve', 'Vuelve En Vivo', 'Yo No Me Dejo', 'Yo No Sé Porque', 'Yo Puedo Con Todos', 'Yo Soy de Aqui (feat. Yandel, Arcangel y Daddy Yankee)', 'Yo Vivo En Guerra Ft. Tempo (version Reggaeton)', 'Zandunguenado', 'Zumb@', 'Zumba']
